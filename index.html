<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Juego Animalitos</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
    }
    #opciones {
      margin-top: 20px;
    }
    .botonLetra {
      font-size: 20px;
      padding: 10px;
      margin: 5px;
      cursor: pointer;
    }
    #scrollJuego {
      display: none;
      position: relative;
      margin: 20px auto;
      border: 2px solid black;
      width: 400px;
      height: 400px;
      overflow: hidden;
    }
    #animal {
      position: absolute;
      width: 50px;
      height: 50px;
    }
    .item {
      position: absolute;
      width: 30px;
      height: 30px;
    }
  </style>
</head>
<body>

  <h1>Juego Animalitos</h1>
  <p id="instruccion">Elige un animal para empezar</p>

  <button onclick="seleccionarAnimal('Perro')">üê∂ Perro</button>
  <button onclick="seleccionarAnimal('Gato')">üê± Gato</button>
  <button onclick="seleccionarAnimal('Conejo')">üê∞ Conejo</button>

  <div id="juego">
    <h2 id="letra"></h2>
    <div id="opciones"></div>
  </div>

  <div id="scrollJuego">
    <p id="scrollInstruccionPrincipal"></p>
    <p id="scrollInstruccion"></p>
    <div id="campoJuego">
      <img id="animal" src="" alt="Animal">
    </div>
  </div>

  <script>
    let animalSeleccionado = null;
    let letraActual = '';
    let modoJuego = 'click'; 
    let modoMayuscula = true;
    let scrollPosY = 150;
    let scrollPuntaje = 0;
    let scrollTiempoRestante = 15;
    let scrollInterval = null;

    function seleccionarAnimal(animal) {
      if (animal === 'Perro') {
        animalSeleccionado = { nombre: 'Perro', emoji: 'üê∂', item: 'Hueso', itemEmoji: 'ü¶¥' };
      } else if (animal === 'Gato') {
        animalSeleccionado = { nombre: 'Gato', emoji: 'üê±', item: 'Pescado', itemEmoji: 'üêü' };
      } else if (animal === 'Conejo') {
        animalSeleccionado = { nombre: 'Conejo', emoji: 'üê∞', item: 'Zanahoria', itemEmoji: 'ü•ï' };
      }
      nuevaLetra();
    }

    function nuevaLetra() {
      letraActual = String.fromCharCode(65 + Math.floor(Math.random() * 26)); 
      document.getElementById("letra").textContent = modoMayuscula ? letraActual : letraActual.toLowerCase();

      if (modoJuego === 'click') {
        document.getElementById("instruccion").textContent = 
          `NIVEL 1: Mueva el rat√≥n y haga CLIC en la letra ${modoMayuscula ? "MAY√öSCULA" : "min√∫scula"} que se muestra.`;
        crearOpcionesBoton();
      } else { 
        document.getElementById("instruccion").textContent = 
          `NIVEL 2: Use el TECLADO y escriba la letra ${modoMayuscula ? "MAY√öSCULA" : "min√∫scula"} que se muestra.`;
      }
    }

    function crearOpcionesBoton() {
      const opcionesDiv = document.getElementById("opciones");
      opcionesDiv.innerHTML = '';
      const letras = [letraActual];
      while (letras.length < 4) {
        let l = String.fromCharCode(65 + Math.floor(Math.random() * 26));
        if (!letras.includes(l)) letras.push(l);
      }
      letras.sort(() => Math.random() - 0.5);

      letras.forEach(l => {
        const btn = document.createElement("button");
        btn.textContent = modoMayuscula ? l : l.toLowerCase();
        btn.className = "botonLetra";
        btn.onclick = () => verificarRespuesta(l);
        opcionesDiv.appendChild(btn);
      });
    }

    function verificarRespuesta(letra) {
      if (letra === letraActual) {
        ganarItem();
      } else {
        alert("¬°Ups! Intenta de nuevo.");
      }
    }

    function ganarItem() {
      alert(`¬°Correcto! ${animalSeleccionado.emoji} gan√≥ un ${animalSeleccionado.itemEmoji}`);

      if (modoJuego === 'click') {
        modoJuego = 'teclado';
        modoMayuscula = false;
        nuevaLetra();
      } else if (modoJuego === 'teclado') {
        document.getElementById("instruccion").textContent = 
          "¬°Excelente! Nivel 2 Superado. Pasando al Nivel 3 (Scroll)...";
        setTimeout(iniciarJuegoScroll, 2000);
      }
    }

    document.addEventListener('keydown', (e) => {
      if (modoJuego === 'teclado') {
        if (e.key.toLowerCase() === letraActual.toLowerCase()) {
          ganarItem();
        } else {
          alert("¬°Letra incorrecta!");
        }
      }
    });

    function iniciarJuegoScroll() {
      document.getElementById("juego").style.display = "none";
      document.getElementById("scrollJuego").style.display = "block";
      document.getElementById('animal').src = animalSeleccionado.emoji;
      document.getElementById('animal').style.top = scrollPosY + "px";
      document.getElementById("scrollInstruccionPrincipal").innerHTML = 
        `NIVEL 3: Usa la <strong>rueda</strong> del rat√≥n para mover el animal y atrapar <strong>${animalSeleccionado.item}</strong>s. ¬°15 segundos!`;
      document.getElementById("scrollInstruccion").textContent = 
        "Mueva la rueda del mouse para empezar.";

      scrollPuntaje = 0;
      scrollTiempoRestante = 15;
      scrollInterval = setInterval(actualizarInstruccion, 1000);
      setTimeout(terminarJuegoScroll, 15000);

      setInterval(crearItem, 2000);

      document.addEventListener("wheel", moverAnimal);
    }

    function actualizarInstruccion() {
      scrollTiempoRestante--;
      document.getElementById("scrollInstruccion").textContent = 
        `Tiempo: ${scrollTiempoRestante}s | ${animalSeleccionado.item}: ${scrollPuntaje}`;
    }

    function moverAnimal(event) {
      scrollPosY += event.deltaY > 0 ? 20 : -20;
      if (scrollPosY < 0) scrollPosY = 0;
      if (scrollPosY > 350) scrollPosY = 350;
      document.getElementById('animal').style.top = scrollPosY + "px";
      verificarColisiones();
    }

    function crearItem() {
      const campo = document.getElementById("campoJuego");
      const item = document.createElement("div");
      item.className = "item";
      item.textContent = animalSeleccionado.itemEmoji;
      item.style.top = Math.floor(Math.random() * 350) + "px";
      item.style.left = "370px";
      campo.appendChild(item);

      let posX = 370;
      const mover = setInterval(() => {
        posX -= 5;
        item.style.left = posX + "px";
        if (posX < 0) {
          clearInterval(mover);
          item.remove();
        }
        verificarColisiones();
      }, 50);
    }

    function verificarColisiones() {
      const animal = document.getElementById("animal").getBoundingClientRect();
      document.querySelectorAll(".item").forEach(item => {
        const rect = item.getBoundingClientRect();
        if (
          rect.left < animal.right &&
          rect.right > animal.left &&
          rect.top < animal.bottom &&
          rect.bottom > animal.top
        ) {
          item.remove();
          scrollPuntaje++;
        }
      });
    }

    function terminarJuegoScroll() {
      clearInterval(scrollInterval);
      document.removeEventListener("wheel", moverAnimal);
      const mensajeFinal = 
        `üéâ ¬°FIN DEL JUEGO! üéâ\nConseguiste ${scrollPuntaje} ${animalSeleccionado.item.toLowerCase()}s en el Nivel 3.`;
      document.getElementById("scrollInstruccion").textContent = mensajeFinal;
    }
  </script>
</body>
</html>
